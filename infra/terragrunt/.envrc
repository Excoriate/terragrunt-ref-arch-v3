#!/usr/bin/env bash
# Terragrunt Layer Environment Configuration

# Ensure PROJECT_ROOT is set
PROJECT_ROOT="${PROJECT_ROOT:-$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)}"
export PROJECT_ROOT

# Source parent .envrc for inheritance
source_up || true

# Source the shared utility functions
source "${PROJECT_ROOT}/scripts/envrc-utils.sh"

# =====================================================================
# ðŸ”§ TERRAGRUNT LAYER CONFIGURATION
# =====================================================================

# Layer name
LAYER_NAME="TERRAGRUNT"

# Terragrunt Cache and Performance Settings
_layer_export TERRAGRUNT_DOWNLOAD_DIR "${HOME}/.terragrunt-cache/$(basename "$PROJECT_ROOT")" "$LAYER_NAME"
_layer_export TERRAGRUNT_CACHE_MAX_AGE "168h" "$LAYER_NAME"

# Terragrunt Logging and Output Control
_layer_export TERRAGRUNT_LOG_LEVEL "info" "$LAYER_NAME"
_layer_export TERRAGRUNT_DISABLE_CONSOLE_OUTPUT "false" "$LAYER_NAME"

# Terraform and Terragrunt Version Management
_layer_export TF_INPUT "0" "$LAYER_NAME"
_layer_export TERRAGRUNT_AUTO_INIT "true" "$LAYER_NAME"
_layer_export TERRAGRUNT_AUTO_RETRY "true" "$LAYER_NAME"

# Optional: Uncomment and modify custom variables as needed
# _layer_export TERRAGRUNT_DEBUG "true" "$LAYER_NAME"
# _layer_export TERRAGRUNT_IAM_ROLE "arn:aws:iam::123456789012:role/terragrunt" "$LAYER_NAME"

# Display Terragrunt layer information
_layer_env_info "$LAYER_NAME" \
  "TERRAGRUNT_DOWNLOAD_DIR:Terragrunt Download Directory" \
  "TERRAGRUNT_LOG_LEVEL:Terragrunt Log Level" \
  "TERRAGRUNT_AUTO_INIT:Auto Initialize" \
  "TERRAGRUNT_AUTO_RETRY:Auto Retry"
